# 02-1 踩点

信息收集可以说是渗透测试中最重要的过程之一，一个简单的逻辑是：你在信息收集这一步做的越好，你得到的有效信息就越多，从而使你的渗透过程就越容易

情报搜集阶段贯穿整个流程

在这个阶段需要完成的两项任务：

1. 通过信息搜集工作，确定渗透测试目标范围
2. 通过情报信息搜集与查点，发现渗透目标的安全漏洞与脆弱点，为后续的渗透攻击提供基础

踩点指的是对特定网络目标准备行动之前，首先要做的是搜集汇总各种与目标系统相关的信息，形成对目标网络必要的轮廓性认识，并为实施攻击做好准备的过程。

## 踩点值得挖掘的信息

- 网页信息：包括联系方式、合作伙伴、公司业务等只管信息
- 域名信息：包括域名服务器、网站联系人、邮件服务器以及其他应用服务器的注册信息
- 网络块：公司注册的IP范围
- 网站结构：初步探测目标网络的模糊拓补结构，包括防火墙位置等
- 其他：诸如一些非常手段得到的有价值信息，如社会工程学等

外围开放的信息采集过程，为进一步攻击做好准备，并不对目标系统本身造成直接影响

特别说明，下面几种类型的信息很容易被攻击者发现：

- 雇员联系方式的详细资料，包括电子邮件地址与电话号码
- 雇员所在办公室与其他地址的物理位置
- 内部电子邮件系统及其路由方式的详细资料
- DNS布局和命名约定，包括域和主机名
- 公共可访问服务器上的文档

## 通过DNS和IP地址挖掘目标网络信息

目标网络对外开放的WEB网站通常是探查的起始点

### whois域名注册信息查询

一个用来查询域名注册信息数据库的工具，一般的域名注册信息会包含域名所有者、服务商、管理员邮件地址、域名注册日期和过期日期等，这些信息往往是非常有价值的。

http://whois.chinaz.com

http://who.is

进行whois查询时请去掉www、ftp等前缀，这是由于机构在注册域名时通常会注册一个上层的域名，其子域名由自身的域名服务器管理，在whois数据库中可能查询不到

### DNS域名地址探测

DNS——域名解析系统，即对目标域名进行信息探测，得到诸如IP地址、子域名信息、mail服务器地址，有了这些具体的IP地址，再下一步就可以针对IP地址进行渗透了

目的就是为了收集尽可能多的关于域名的一切信息，利用以下手段得到域名对应的IP地址以及子域名及其IP

1. 利用google发现尽可能多的子域名信息及其他相关信息
2. 利用暴力遍历法尝试字典文件中的各子域名是否能够被访问
3. 提供DNS反向查询

  #### dnsmap——DNS暴力破解域名

dnsmap是一款搜集信息的工具，该工具可以使用内在字符串或者外在字典，其最主要的功能就是用来获取域名对应的子域名信息

> dnsmap baidu.com -w wordlist_TLAs.txt -r baidu.txt
>
> -w 为指定子域名字典文件，这里时dnsmap自带的wordlist_TLAs.txt文件
>
> -r 为指定将执行的结果以常规形式保存，保存文件名为baidu.txt

可以在默认字典的基础上加一些如oa、zabbix、nagios、cacti、erp、sap、crm等待，不少企业都是这种命名方式

### DNS探测——dnsenum

dnsenum的目的是尽可能收集一个域的信息，它能够通过谷歌或者字典文件猜测可能存在的域名，以及对一个网段进行反向查询。它可以查询网站的主机地址信息、域名服务器、MX record(函件交换记录)，在域名服务器上执行axfr请求，通过谷歌脚本得到扩展域名信息(google hacking)，提取自域名并查询，计算C类地址并执行whois查询，执行反向查询，把地址段写入文件

> dnsenum pl --enum microsofi.com
>
> 对Microsoft网站域名进行探测解析

### 通过IP反查域名

IP反查域名是指定IP下面的域名列表

http://www.114best.com/ip/

dns.aizhan.com

其意义在于：

- 旁攻（旁注）：

  目标网站的程序安全性非常完美，通过攻击跟目标网站同一服务器的其他安全性的网站，然后进一步提升到控制整个服务器

  目标主机的安全性非常完美，通过攻击跟目标主机同一网段（广播域）的其他的安全性较差的服务器，然后进一步通过通信等欺骗手段来嗅探目标服务器的密码等信息

### 查找域名在CDN保护下的真正IP

CDN（Content Delivery Network，内容分发网络）：其基本思路就是尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快、更稳定

国外：http://searchdns.netcraft.com

国内：http://ping.chinaz.com

## 通过搜索引擎或者web

在利用DNS域名和IP地址查询搜集到目标网络的相关位置和范围信息之后，下一步就可以对这些目标进行信息探查和搜集

目标网络对外公开的WEB网站通常使探查的七十点，而许多流行的搜索引擎提供了功能强大的在线WEB网站信息高级搜索功能，利用它们能够轻易地发现关于渗透目标的一些细枝末节的信息。在信息搜集过程中千万不要忘了使用搜索引擎对目标进行一些探测，这些工作不需要耗费太多的精力，却往往会带来意想不到的效果

### Google Hacking

Google Hacking原指利用Google搜索引擎搜索信息进行入侵的技术和行为，现指利用各种搜索引擎搜索信息来进行入侵的技术和行为。可以通过利用各搜索引擎强大的功能来挖掘目标网络中的一些隐秘信息，例如没改名的mdb文件、别人留下的webshell或者其他的一些隐秘文件。使用google中的一些语法可以提供更多的信息。

一些自动化工具能够帮助你更方便地利用Google及其他搜索引擎进行信息搜集，比如siteDigger和Search Diggty。

### 探索网站地目录结构

Web网站同你使用地文件系统一样，会按照内容或功能分出一些子目录。有些目录是希望来被来访者看到的，而有些则可能存储了一些不希望被所有人查看的内容，比如一些存储了私人文件的目录，以及管理后台目录等。

一些程序员喜欢将后台管理目录命名为一些常见的名字，如admin、login、cms等。在对网站进行分析时，可以手工测试一下这些常见的目录名，说不定就会有收获。

可以在google中输入：上级目录 site:xxx.cn来查找xxx.cn上的此类目录（英文站点是parent directory）

子域名也可通过搜索引擎语法site:xxx.com来收集

### 检索特定类型的文件

一些缺乏安全意识的网站管理员为了方便往往会将类似通讯录、订单等内容敏感的文件链接到网站上，可以在Google上针对此类文件进行查找，如google中输入site:testfire.net filetype:xls

### 搜索网站中的e-mail地址

聪明的渗透攻击者可能会通过多种手段搜集你的信息，然后结合社会工程学的一些基本知识，如生活习惯、兴趣爱好、社交圈子，发来专为你定制的包含钓鱼链接或恶意附件的邮件。当然，想要利用邮件进行渗透攻击的第一步是获取邮件地址。有一类没有固定目标的攻击者会通过一些自动化工具搜集大量的邮件地址，然后将邮件群发到这些地址以增加攻击成功的机率。而在渗透测试工作中通常目标是固定的，可以使用kali中一个非常有用的模块search_email_collector，进行有针对性的邮件地址搜集。

### 破解目标的管理人员、员工的邮件地址或其他网络联系方式的密码

通过搜索到目标的管理人员、员工的e-mail或者联系方式进行破解，往往可以获得意想不到的效果

## SpiderFoot

- 免费、开源
- 给定域名来获得如子域、电子邮件地址、调用netblocks、web服务器版本等等
- 最大限度地释放一个渗透测试人员的时间，集中精力于安全测试本身

## whatweb

whatweb是一款网站指纹识别工具

可以告诉你网站搭建使用的程序，包括：

- cms系统
- 博客系统
- JavaScript库
- web服务器
- 内嵌设备
- ...

可定制http头、可进行基础认证设置、可覆盖跳转状况





























